version: '3'

services:
    prometheus:
        image: prom/prometheus:latest
        volumes:
            - ./prometheus.yml:/etc/prometheus/prometheus.yml
            - ./alert.rules:/etc/prometheus/alert.rules
        command:
            - '-config.file=/etc/prometheus/prometheus.yml'
        ports:
            - '9090:9090'
        deploy:
          placement:
            constraints: [node.role == manager]

    node-exporter:
        image: prom/node-exporter:latest
        ports:
            - '9100:9100'
        deploy:
          placement:
            constraints: [node.role == manager]

    cadvisor-exporter:
        container_name: "cadvisor-exporter"
        image: google/cadvisor
        ports:
          - "9200:8080"
        volumes:
          - "/:/rootfs:ro"
          - "/var/run:/var/run:rw"
          - "/sys:/sys:ro"
          - "/var/lib/docker/:/var/lib/docker:ro"
        deploy:
          placement:
            constraints: [node.role == manager]
